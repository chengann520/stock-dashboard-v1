name: Daily Stock ETL

on:
  schedule:
    - cron: '0 22 * * 1-5' # 22:00 UTC = 06:00 Taipei time (周一到周五)
  workflow_dispatch:       # 允許手動按按鈕測試

jobs:
  etl:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # 建議用 3.11 避免太舊的版本問題

      - name: Install Dependencies
        # 這裡我加強了一下：如果找不到 requirements.txt，就直接安裝套件
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; else pip install pandas sqlalchemy psycopg2-binary python-dotenv yfinance; fi

      - name: Run ETL Pipeline
        env:
          # 關鍵修正：對應你的 Python 程式碼和 GitHub Secrets
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
        run: python main.py
